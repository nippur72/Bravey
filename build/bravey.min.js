// Bravey v0.1 - http://github.com/braveyjs/bravey - MIT Licensed
var Bravey={REVISION:"0.1"};"function"==typeof define&&define.amd?define("Bravey",Bravey):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=Bravey),Bravey.DATA={},Bravey.Language={},Bravey.Nlp={},Bravey.Filter={},Bravey.SessionManager={},Bravey.Text={},Bravey.Text.WORDSEP="[^(a-zA-ZA-Яa-я0-9_!?.:)+s]*",Bravey.Text.TRIMSTART=new RegExp("^("+Bravey.Text.WORDSEP+")","gi"),Bravey.Text.TRIMEND=new RegExp("("+Bravey.Text.WORDSEP+")$","gi"),Bravey.Text.generateGUID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Bravey.Text.calculateScore=function(e,t){for(var r=0,n=0;n<t.length;n++)e[t[n]]&&r++;return r},Bravey.Text.entityTrim=function(e){var t=e.string.match(Bravey.Text.TRIMSTART),r=e.string.match(Bravey.Text.TRIMEND),n=t?t[0].length:0,i=r?r[0].length:0;return e.position+=n,e.string=e.string.substr(n,e.string.length-n-i),e},Bravey.Text.RegexMap=function(e,t){for(var r=0;r<e.length;r++){e[r].mtch=[];for(var n=0;n<e[r].str.length;n++)e[r].mtch.push(e[r].str[n].replace(/~/g,""))}this.regex=function(t){for(var r="(",n=0;n<e.length;n++)for(var i=0;i<e[n].str.length;i++)r+=e[n].str[i].replace(/~/g,"\\b")+"|";return r.substr(0,r.length-1)+")"+(t?"":"?")},this.get=function(r,n,i){for(var a=0;a<e.length;a++)for(var s=0;s<e[a].mtch.length;s++)if(r[n]==e[a].mtch[s])return e[a].val;return void 0==i?t:i}},Bravey.Text.unique=function(e){for(var t={},r=[],n=0,i=e.length;n<i;++n)t.hasOwnProperty(e[n])||(r.push(e[n]),t[e[n]]=1);return r},Bravey.Text.clean=function(e){return Bravey.Text.removeDiacritics(e).toLowerCase().trim().replace(/ +(?= )/g,"").replace(/[()\[\]]/g,"")},Bravey.Text.pad=function(e,t,r){return r=r||"0",e+="",e.length>=t?e:new Array(t-e.length+1).join(r)+e},Bravey.Text.tokenize=function(e){var t=e.replace(/[^(a-zA-ZA-Яa-я0-9_)+\s]/g," ").trim().replace(/ +(?= )/g,"");return Bravey.Text.unique(t.split(/\s+/))},Bravey.DATA.diacriticsMap={},Bravey.Text.removeDiacritics=function(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return Bravey.DATA.diacriticsMap[e]||e})},function(){defaultDiacriticsRemovalap=[{base:" ",letters:" "},{base:"0",letters:"߀"},{base:"A",letters:"ⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"ⒷＢḂḄḆɃƁ"},{base:"C",letters:"ⒸＣꜾḈĆCĈĊČÇƇȻ"},{base:"D",letters:"ⒹＤḊĎḌḐḒḎĐƊƉᴅꝹ"},{base:"Dh",letters:"Ð"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"ɛⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎᴇ"},{base:"F",letters:"ꝼⒻＦḞƑꝻ"},{base:"G",letters:"ⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾɢ"},{base:"H",letters:"ⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"ⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"ⒿＪĴɈȷ"},{base:"K",letters:"ⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"ⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"ⓂＭḾṀṂⱮƜϻ"},{base:"N",letters:"ꞤȠⓃＮǸŃÑṄŇṆŅṊṈƝꞐᴎ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"ⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OE",letters:"Œ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"ⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"ⓆＱꝖꝘɊ"},{base:"R",letters:"ⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"ⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"ⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"Th",letters:"Þ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"ⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"ⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"ⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"ⓍＸẊẌ"},{base:"Y",letters:"ⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"ⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"ⓑｂḃḅḇƀƃɓƂ"},{base:"c",letters:"ｃⓒćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"ⓓｄḋďḍḑḓḏđƌɖɗƋᏧԁꞪ"},{base:"dh",letters:"ð"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"ⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇǝ"},{base:"f",letters:"ⓕｆḟƒ"},{base:"ff",letters:"ﬀ"},{base:"fi",letters:"ﬁ"},{base:"fl",letters:"ﬂ"},{base:"ffi",letters:"ﬃ"},{base:"ffl",letters:"ﬄ"},{base:"g",letters:"ⓖｇǵĝḡğġǧģǥɠꞡꝿᵹ"},{base:"h",letters:"ⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"ⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"ⓙｊĵǰɉ"},{base:"k",letters:"ⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"ⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇɭ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"ⓜｍḿṁṃɱɯ"},{base:"n",letters:"ⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"ⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿꝋꝍɵɔᴑ"},{base:"oe",letters:"œ"},{base:"oi",letters:"ƣ"},{base:"oo",letters:"ꝏ"},{base:"ou",letters:"ȣ"},{base:"p",letters:"ⓟｐṕṗƥᵽꝑꝓꝕρ"},{base:"q",letters:"ⓠｑɋꝗꝙ"},{base:"r",letters:"ⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"ⓢｓśṥŝṡšṧṣṩșşȿꞩꞅẛʂ"},{base:"ss",letters:"ß"},{base:"t",letters:"ⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"th",letters:"þ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"ⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"ⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"ⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"ⓧｘẋẍ"},{base:"y",letters:"ⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"ⓩｚźẑżžẓẕƶȥɀⱬꝣ"}];for(var e=0;e<defaultDiacriticsRemovalap.length;e++)for(var t=defaultDiacriticsRemovalap[e].letters,r=0;r<t.length;r++)Bravey.DATA.diacriticsMap[t[r]]=defaultDiacriticsRemovalap[e].base}(),Bravey.Date={},Bravey.Date.SECOND=1e3,Bravey.Date.MINUTE=60*Bravey.Date.SECOND,Bravey.Date.HOUR=60*Bravey.Date.MINUTE,Bravey.Date.DAY=24*Bravey.Date.HOUR,Bravey.Date.formatDate=function(e){var t=new Date(e);return Bravey.Text.pad(t.getFullYear(),4)+"-"+Bravey.Text.pad(t.getMonth()+1,2)+"-"+Bravey.Text.pad(t.getDate(),2)},Bravey.Date.formatTime=function(e){return Bravey.Text.pad(Math.floor(e/Bravey.Date.HOUR),2)+":"+Bravey.Text.pad(Math.floor(e%Bravey.Date.HOUR/Bravey.Date.MINUTE),2)+":"+Bravey.Text.pad(Math.floor(e%Bravey.Date.MINUTE/Bravey.Date.SECOND),2)},Bravey.Date.centuryFinder=function(e){return e<100?e>20?e+1900:e+2e3:e},Bravey.Data={},Bravey.Data.getEntityValue=function(e,t,r){var n;return e&&(void 0!==e.result&&void 0!==e.result.entitiesIndex&&void 0!==e.result.entitiesIndex[t]&&(n=e.result.entitiesIndex[t].value),n==r&&(n=void 0),void 0==n&&void 0!==e.sessionData&&(n=e.sessionData[t])),n},Bravey.Data.isExplicit=function(e,t){return e&&void 0!==e.result&&void 0!==e.result.entitiesIndex&&void 0!==e.result.entitiesIndex[t]},Bravey.stemmerSupport={Among:function(e,t,r,n){if(this.toCharArray=function(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r},!e&&""!=e||!t&&0!=t||!r)throw"Bad Among initialisation: s:"+e+", substring_i: "+t+", result: "+r;this.s_size=e.length,this.s=this.toCharArray(e),this.substring_i=t,this.result=r,this.method=n},SnowballProgram:function(){var e;return{bra:0,ket:0,limit:0,cursor:0,limit_backward:0,setCurrent:function(t){e=t,this.cursor=0,this.limit=t.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit},getCurrent:function(){var t=e;return e=null,t},in_grouping:function(t,r,n){if(this.cursor<this.limit){var i=e.charCodeAt(this.cursor);if(i<=n&&i>=r&&(i-=r,t[i>>3]&1<<(7&i)))return this.cursor++,!0}return!1},in_grouping_b:function(t,r,n){if(this.cursor>this.limit_backward){var i=e.charCodeAt(this.cursor-1);if(i<=n&&i>=r&&(i-=r,t[i>>3]&1<<(7&i)))return this.cursor--,!0}return!1},out_grouping:function(t,r,n){if(this.cursor<this.limit){var i=e.charCodeAt(this.cursor);if(i>n||i<r)return this.cursor++,!0;if(i-=r,!(t[i>>3]&1<<(7&i)))return this.cursor++,!0}return!1},out_grouping_b:function(t,r,n){if(this.cursor>this.limit_backward){var i=e.charCodeAt(this.cursor-1);if(i>n||i<r)return this.cursor--,!0;if(i-=r,!(t[i>>3]&1<<(7&i)))return this.cursor--,!0}return!1},eq_s:function(t,r){if(this.limit-this.cursor<t)return!1;for(var n=0;n<t;n++)if(e.charCodeAt(this.cursor+n)!=r.charCodeAt(n))return!1;return this.cursor+=t,!0},eq_s_b:function(t,r){if(this.cursor-this.limit_backward<t)return!1;for(var n=0;n<t;n++)if(e.charCodeAt(this.cursor-t+n)!=r.charCodeAt(n))return!1;return this.cursor-=t,!0},find_among:function(t,r){for(var n=0,i=r,a=this.cursor,s=this.limit,o=0,u=0,l=!1;;){for(var c=n+(i-n>>1),f=0,v=o<u?o:u,g=t[c],d=v;d<g.s_size;d++){if(a+v==s){f=-1;break}if(f=e.charCodeAt(a+v)-g.s[d])break;v++}if(f<0?(i=c,u=v):(n=c,o=v),i-n<=1){if(n>0||i==n||l)break;l=!0}}for(;;){var g=t[n];if(o>=g.s_size){if(this.cursor=a+g.s_size,!g.method)return g.result;var h=g.method();if(this.cursor=a+g.s_size,h)return g.result}if((n=g.substring_i)<0)return 0}},find_among_b:function(t,r){for(var n=0,i=r,a=this.cursor,s=this.limit_backward,o=0,u=0,l=!1;;){for(var c=n+(i-n>>1),f=0,v=o<u?o:u,g=t[c],d=g.s_size-1-v;d>=0;d--){if(a-v==s){f=-1;break}if(f=e.charCodeAt(a-1-v)-g.s[d])break;v++}if(f<0?(i=c,u=v):(n=c,o=v),i-n<=1){if(n>0||i==n||l)break;l=!0}}for(;;){var g=t[n];if(o>=g.s_size){if(this.cursor=a-g.s_size,!g.method)return g.result;var h=g.method();if(this.cursor=a-g.s_size,h)return g.result}if((n=g.substring_i)<0)return 0}},replace_s:function(t,r,n){var i=n.length-(r-t),a=e.substring(0,t),s=e.substring(r);return e=a+n+s,this.limit+=i,this.cursor>=r?this.cursor+=i:this.cursor>t&&(this.cursor=t),i},slice_check:function(){if(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>e.length)throw"faulty slice operation"},slice_from:function(e){this.slice_check(),this.replace_s(this.bra,this.ket,e)},slice_del:function(){this.slice_from("")},insert:function(e,t,r){var n=this.replace_s(e,t,r);e<=this.bra&&(this.bra+=n),e<=this.ket&&(this.ket+=n)},slice_to:function(){return this.slice_check(),e.substring(this.bra,this.ket)},eq_v_b:function(e){return this.eq_s_b(e.length,e)}}}},Bravey.FreeTextEntityRecognizer=function(e,t){var r=/\"([^\"]*)\"/,n=[],i=[];this.getName=function(){return e},this.addPrefix=function(e){-1==n.indexOf(e)&&n.push(e)},this.addConjunction=function(e){i.push(new RegExp("^\\b"+e+"\\b","gi")),i.push(new RegExp("\\b"+e+"\\b$","gi"))},this.getEntities=function(e,t){return t},this.expand=function(e){var t,a,s=-1,o=-1;if(null!=(a=r.exec(e.string)))e.position+=a.index+1,e.string=a[1];else{for(var u=0;u<n.length;u++)-1!=(t=e.string.indexOf(n[u]))&&(-1==o||t<o)&&(o=t,s=t+n[u].length);-1!=s&&(e.position+=s,e.string=e.string.substr(s)),Bravey.Text.entityTrim(e);do{o=0;for(var u=0;u<i.length;u++)null!=(a=i[u].exec(e.string))&&(o=1,0==a.index?(e.string=e.string.substr(a[0].length),e.position+=a[0].length):e.string=e.string.substr(0,a.index),Bravey.Text.entityTrim(e))}while(o);-1!=(t=e.string.lastIndexOf("."))&&(e.string=e.string.substr(0,t)),Bravey.Text.entityTrim(e)}e.value=e.string}},Bravey.StringEntityRecognizer=function(e,t){function r(){n.sort(function(e,t){return e.text.length>t.text.length?-1:e.text.length<t.text.length?1:0})}var n=[],i={},a=!1;this.getName=function(){return e},this.addMatch=function(e,t){return t=Bravey.Text.clean(t),i[t]||(i[t]=1,a=!1,n.push({text:t,id:e,regex:new RegExp("\\b"+t+"\\b","gi")})),!0},this.getEntities=function(i,s){i=Bravey.Text.clean(i),a||(a=!0,r());var o,u;s||(s=[]);for(var l,c=i,f=0;f<n.length;f++)for(;null!=(u=n[f].regex.exec(c));){o=i.substr(u.index,u[0].length),s.push({position:u.index,entity:e,value:n[f].id,string:o,priority:t||0}),l=c.substr(0,u.index);for(var v=0;v<u[0].length;v++)l+=" ";l+=c.substr(u.index+u[0].length),c=l}return s}},Bravey.NumberEntityRecognizer=function(e){var t=new RegExp("\\b[0-9]+\\b","gi");this.getName=function(){return e},this.getEntities=function(r,n){r=Bravey.Text.clean(r);var i,a;n||(n=[]);for(var s=r;null!=(a=t.exec(s));)i=r.substr(a.index,a[0].length),n.push({position:a.index,entity:e,value:1*i,string:i});return n}},Bravey.RegexEntityRecognizer=function(e){function t(e){e.sort(function(e,t){return e.position<t.position?-1:e.position>t.position?1:e.string.length>t.string.length?-1:e.string.length<t.string.length?1:e.priority>t.priority?-1:e.priority<t.priority?1:0})}var r=[];this.addMatch=function(e,t,n){r.push({regex:e,callback:t,priority:n||0})},this.getName=function(){return e},this.getEntities=function(n,i){n=Bravey.Text.clean(n);var a,s,o,u=[],l=-1;i||(i=[]);for(var c=n,f=0;f<r.length;f++)for(;null!=(o=r[f].regex.exec(c));)s=n.substr(o.index,o[0].length),void 0!==(a=r[f].callback(o))&&u.push(Bravey.Text.entityTrim({value:a,entity:e,position:o.index,string:s,priority:r[f].priority}));t(u);for(var f=0;f<u.length;f++)u[f].position>=l&&(i.push(u[f]),l=u[f].position+u[f].string.length);return i},this.bindTo=function(e){var t=this;e.getName=function(){return t.getName()},e.getEntities=function(e,r){return t.getEntities(e,r)}}},Bravey.EMailEntityRecognizer=function(e,t){var r=/(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/g;this.getName=function(){return e},this.getEntities=function(n,i){var a,s;for(i||(i=[]);null!=(s=r.exec(n));)a=n.substr(s.index,s[0].length),i.push({position:s.index,entity:e,value:a,string:a,priority:t||0});return i}},Bravey.DocumentClassifier=function(e){e=e||{};var t={},r=function(e,t){return"stem:"+e+"::label:"+t},n=function(e){return"docCount:"+e},i=function(e){return"stemCount:"+e},a=function(e){},s=function(){var e=t.registeredLabels;return e||(e=""),e.split(",").filter(function(e){return e.length})},o=function(e){var r=s();return-1===r.indexOf(e)&&(r.push(e),t.registeredLabels=r.join(",")),!0},u=function(e,n){var i=parseInt(t[r(e,n)]);return i||(i=0),i},l=function(e,t){for(var r=s(),n=0,i=0,a=r.length;i<a;i++)r[i]!==t&&(n+=parseInt(u(e,r[i])));return n},c=function(e){var r=parseInt(t[i(e)]);return r||(r=0),r},f=function(e){var r=parseInt(t[n(e)]);return r||(r=0),r},v=function(e){for(var t=s(),r=0,n=0,i=t.length;n<i;n++)t[n]!==e&&(r+=parseInt(f(t[n])));return r},g=function(e){var r=parseInt(t[e]);return r||(r=0),t[e]=parseInt(r)+1,r+1},d=function(e,t){g(i(e)),g(r(e,t))},h=function(e){return g(n(e))},b=function(t,r){o(r);var n=Bravey.Text.tokenize(Bravey.Text.clean(t));e.filter&&(n=e.filter(n));for(var i=n.length,a=0;a<i;a++)d(e.stemmer?e.stemmer(n[a]):n[a],r);h(r)},p=function(t){var r=Bravey.Text.tokenize(Bravey.Text.clean(t));e.filter&&(r=e.filter(r));for(var n=r.length,i=s(),o=0,g={},d={},h={},b={},p=0;p<i.length;p++){var m=i[p];g[m]=f(m),d[m]=v(m),o+=parseInt(g[m])}for(var p=0;p<i.length;p++){var m=i[p],w=0;b[m]=g[m]/o;for(var y=0;y<n;y++){var x=e.stemmer?e.stemmer(r[y]):r[y],B=c(x);if(0!==B){var D=u(x,m)/g[m],T=l(x,m)/d[m],_=D/(D+T);_=(.5+B*_)/(1+B),0===_?_=.01:1===_&&(_=.99),w+=Math.log(1-_)-Math.log(_),a(m+"icity of "+x+": "+_)}}h[m]=1/(1+Math.exp(w))}return h},m=function(e){var t=0,r=null;for(var n in e)e[n]>t&&(t=e[n],r=n);return{label:r,score:t}};this.addDocument=function(e,t){return b(e,t),e},this.classifyDocument=function(e){var t=p(e);return{scores:t,winner:m(t)}},this.addDocument("","none")},Bravey.Language.IT={},Bravey.Language.IT.Stemmer=function(){var e=Bravey.stemmerSupport.Among,t=Bravey.stemmerSupport.SnowballProgram,r=new function(){function r(e,t,r){return!(!S.eq_s(1,e)||(S.ket=S.cursor,!S.in_grouping(I,97,249)))&&(S.slice_from(t),S.cursor=r,!0)}function n(){for(var e,t,n,i,a=S.cursor;;){if(S.bra=S.cursor,e=S.find_among(x,7))switch(S.ket=S.cursor,e){case 1:S.slice_from("à");continue;case 2:S.slice_from("è");continue;case 3:S.slice_from("ì");continue;case 4:S.slice_from("ò");continue;case 5:S.slice_from("ù");continue;case 6:S.slice_from("qU");continue;case 7:if(S.cursor>=S.limit)break;S.cursor++;continue}break}for(S.cursor=a;;)for(t=S.cursor;;){if(n=S.cursor,S.in_grouping(I,97,249)){if(S.bra=S.cursor,i=S.cursor,r("u","U",n))break;if(S.cursor=i,r("i","I",n))break}if(S.cursor=n,S.cursor>=S.limit)return void(S.cursor=t);S.cursor++}}function i(e){if(S.cursor=e,!S.in_grouping(I,97,249))return!1;for(;!S.out_grouping(I,97,249);){if(S.cursor>=S.limit)return!1;S.cursor++}return!0}function a(){if(S.in_grouping(I,97,249)){var e=S.cursor;if(S.out_grouping(I,97,249)){for(;!S.in_grouping(I,97,249);){if(S.cursor>=S.limit)return i(e);S.cursor++}return!0}return i(e)}return!1}function s(){var e,t=S.cursor;if(!a()){if(S.cursor=t,!S.out_grouping(I,97,249))return;if(e=S.cursor,S.out_grouping(I,97,249)){for(;!S.in_grouping(I,97,249);){if(S.cursor>=S.limit)return S.cursor=e,void(S.in_grouping(I,97,249)&&S.cursor<S.limit&&S.cursor++);S.cursor++}return void(y=S.cursor)}if(S.cursor=e,!S.in_grouping(I,97,249)||S.cursor>=S.limit)return;S.cursor++}y=S.cursor}function o(){for(;!S.in_grouping(I,97,249);){if(S.cursor>=S.limit)return!1;S.cursor++}for(;!S.out_grouping(I,97,249);){if(S.cursor>=S.limit)return!1;S.cursor++}return!0}function u(){var e=S.cursor;y=S.limit,w=y,m=y,s(),S.cursor=e,o()&&(w=S.cursor,o()&&(m=S.cursor))}function l(){for(var e;;){if(S.bra=S.cursor,!(e=S.find_among(B,3)))break;switch(S.ket=S.cursor,e){case 1:S.slice_from("i");break;case 2:S.slice_from("u");break;case 3:if(S.cursor>=S.limit)return;S.cursor++}}}function c(){return y<=S.cursor}function f(){return w<=S.cursor}function v(){return m<=S.cursor}function g(){var e;if(S.ket=S.cursor,S.find_among_b(D,37)&&(S.bra=S.cursor,(e=S.find_among_b(T,5))&&c()))switch(e){case 1:S.slice_del();break;case 2:S.slice_from("e")}}function d(){var e;if(S.ket=S.cursor,!(e=S.find_among_b(R,51)))return!1;switch(S.bra=S.cursor,e){case 1:if(!v())return!1;S.slice_del();break;case 2:if(!v())return!1;S.slice_del(),S.ket=S.cursor,S.eq_s_b(2,"ic")&&(S.bra=S.cursor,v()&&S.slice_del());break;case 3:if(!v())return!1;S.slice_from("log");break;case 4:if(!v())return!1;S.slice_from("u");break;case 5:if(!v())return!1;S.slice_from("ente");break;case 6:if(!c())return!1;S.slice_del();break;case 7:if(!f())return!1;S.slice_del(),S.ket=S.cursor,e=S.find_among_b(_,4),e&&(S.bra=S.cursor,v()&&(S.slice_del(),1==e&&(S.ket=S.cursor,S.eq_s_b(2,"at")&&(S.bra=S.cursor,v()&&S.slice_del()))));break;case 8:if(!v())return!1;S.slice_del(),S.ket=S.cursor,e=S.find_among_b(E,3),e&&(S.bra=S.cursor,1==e&&v()&&S.slice_del());break;case 9:if(!v())return!1;S.slice_del(),S.ket=S.cursor,S.eq_s_b(2,"at")&&(S.bra=S.cursor,v()&&(S.slice_del(),S.ket=S.cursor,S.eq_s_b(2,"ic")&&(S.bra=S.cursor,v()&&S.slice_del())))}return!0}function h(){var e,t;S.cursor>=y&&(t=S.limit_backward,S.limit_backward=y,S.ket=S.cursor,e=S.find_among_b(k,87),e&&(S.bra=S.cursor,1==e&&S.slice_del()),S.limit_backward=t)}function b(){var e=S.limit-S.cursor;if(S.ket=S.cursor,S.in_grouping_b(C,97,242)&&(S.bra=S.cursor,c()&&(S.slice_del(),S.ket=S.cursor,S.eq_s_b(1,"i")&&(S.bra=S.cursor,c()))))return void S.slice_del();S.cursor=S.limit-e}function p(){b(),S.ket=S.cursor,S.eq_s_b(1,"h")&&(S.bra=S.cursor,S.in_grouping_b(M,99,103)&&c()&&S.slice_del())}var m,w,y,x=[new e("",-1,7),new e("qu",0,6),new e("á",0,1),new e("é",0,2),new e("í",0,3),new e("ó",0,4),new e("ú",0,5)],B=[new e("",-1,3),new e("I",0,1),new e("U",0,2)],D=[new e("la",-1,-1),new e("cela",0,-1),new e("gliela",0,-1),new e("mela",0,-1),new e("tela",0,-1),new e("vela",0,-1),new e("le",-1,-1),new e("cele",6,-1),new e("gliele",6,-1),new e("mele",6,-1),new e("tele",6,-1),new e("vele",6,-1),new e("ne",-1,-1),new e("cene",12,-1),new e("gliene",12,-1),new e("mene",12,-1),new e("sene",12,-1),new e("tene",12,-1),new e("vene",12,-1),new e("ci",-1,-1),new e("li",-1,-1),new e("celi",20,-1),new e("glieli",20,-1),new e("meli",20,-1),new e("teli",20,-1),new e("veli",20,-1),new e("gli",20,-1),new e("mi",-1,-1),new e("si",-1,-1),new e("ti",-1,-1),new e("vi",-1,-1),new e("lo",-1,-1),new e("celo",31,-1),new e("glielo",31,-1),new e("melo",31,-1),new e("telo",31,-1),new e("velo",31,-1)],T=[new e("ando",-1,1),new e("endo",-1,1),new e("ar",-1,2),new e("er",-1,2),new e("ir",-1,2)],_=[new e("ic",-1,-1),new e("abil",-1,-1),new e("os",-1,-1),new e("iv",-1,1)],E=[new e("ic",-1,1),new e("abil",-1,1),new e("iv",-1,1)],R=[new e("ica",-1,1),new e("logia",-1,3),new e("osa",-1,1),new e("ista",-1,1),new e("iva",-1,9),new e("anza",-1,1),new e("enza",-1,5),new e("ice",-1,1),new e("atrice",7,1),new e("iche",-1,1),new e("logie",-1,3),new e("abile",-1,1),new e("ibile",-1,1),new e("usione",-1,4),new e("azione",-1,2),new e("uzione",-1,4),new e("atore",-1,2),new e("ose",-1,1),new e("ante",-1,1),new e("mente",-1,1),new e("amente",19,7),new e("iste",-1,1),new e("ive",-1,9),new e("anze",-1,1),new e("enze",-1,5),new e("ici",-1,1),new e("atrici",25,1),new e("ichi",-1,1),new e("abili",-1,1),new e("ibili",-1,1),new e("ismi",-1,1),new e("usioni",-1,4),new e("azioni",-1,2),new e("uzioni",-1,4),new e("atori",-1,2),new e("osi",-1,1),new e("anti",-1,1),new e("amenti",-1,6),new e("imenti",-1,6),new e("isti",-1,1),new e("ivi",-1,9),new e("ico",-1,1),new e("ismo",-1,1),new e("oso",-1,1),new e("amento",-1,6),new e("imento",-1,6),new e("ivo",-1,9),new e("ità",-1,8),new e("istà",-1,1),new e("istè",-1,1),new e("istì",-1,1)],k=[new e("isca",-1,1),new e("enda",-1,1),new e("ata",-1,1),new e("ita",-1,1),new e("uta",-1,1),new e("ava",-1,1),new e("eva",-1,1),new e("iva",-1,1),new e("erebbe",-1,1),new e("irebbe",-1,1),new e("isce",-1,1),new e("ende",-1,1),new e("are",-1,1),new e("ere",-1,1),new e("ire",-1,1),new e("asse",-1,1),new e("ate",-1,1),new e("avate",16,1),new e("evate",16,1),new e("ivate",16,1),new e("ete",-1,1),new e("erete",20,1),new e("irete",20,1),new e("ite",-1,1),new e("ereste",-1,1),new e("ireste",-1,1),new e("ute",-1,1),new e("erai",-1,1),new e("irai",-1,1),new e("isci",-1,1),new e("endi",-1,1),new e("erei",-1,1),new e("irei",-1,1),new e("assi",-1,1),new e("ati",-1,1),new e("iti",-1,1),new e("eresti",-1,1),new e("iresti",-1,1),new e("uti",-1,1),new e("avi",-1,1),new e("evi",-1,1),new e("ivi",-1,1),new e("isco",-1,1),new e("ando",-1,1),new e("endo",-1,1),new e("Yamo",-1,1),new e("iamo",-1,1),new e("avamo",-1,1),new e("evamo",-1,1),new e("ivamo",-1,1),new e("eremo",-1,1),new e("iremo",-1,1),new e("assimo",-1,1),new e("ammo",-1,1),new e("emmo",-1,1),new e("eremmo",54,1),new e("iremmo",54,1),new e("immo",-1,1),new e("ano",-1,1),new e("iscano",58,1),new e("avano",58,1),new e("evano",58,1),new e("ivano",58,1),new e("eranno",-1,1),new e("iranno",-1,1),new e("ono",-1,1),new e("iscono",65,1),new e("arono",65,1),new e("erono",65,1),new e("irono",65,1),new e("erebbero",-1,1),new e("irebbero",-1,1),new e("assero",-1,1),new e("essero",-1,1),new e("issero",-1,1),new e("ato",-1,1),new e("ito",-1,1),new e("uto",-1,1),new e("avo",-1,1),new e("evo",-1,1),new e("ivo",-1,1),new e("ar",-1,1),new e("ir",-1,1),new e("erà",-1,1),new e("irà",-1,1),new e("erò",-1,1),new e("irò",-1,1)],I=[17,65,16,0,0,0,0,0,0,0,0,0,0,0,0,128,128,8,2,1],C=[17,65,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,8,2],M=[17],S=new t;this.setCurrent=function(e){S.setCurrent(e)},this.getCurrent=function(){return S.getCurrent()},this.stem=function(){var e=S.cursor;return n(),S.cursor=e,u(),S.limit_backward=e,S.cursor=S.limit,g(),S.cursor=S.limit,d()||(S.cursor=S.limit,h()),S.cursor=S.limit,p(),S.cursor=S.limit_backward,l(),!0}};return function(e){return r.setCurrent(e),r.stem(),r.getCurrent()}}(),Bravey.Language.IT.TimeEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r=new Bravey.Text.RegexMap([{str:["meno un quarto~"],val:-45*Bravey.Date.MINUTE},{str:["meno venti~"," meno 20"],val:-20*Bravey.Date.MINUTE},{str:["meno un quarto~"],val:-15*Bravey.Date.MINUTE},{str:["mezza~","trenta"],val:30*Bravey.Date.MINUTE},{str:["venti~"],val:30*Bravey.Date.MINUTE},{str:["un quarto~","quindici~","un quarto~"],val:15*Bravey.Date.MINUTE}],0),n=new Bravey.Text.RegexMap([{str:["di mattina~","del mattino~","am~","antimeridiane~"],val:0},{str:["di pomeriggio~","del pomeriggio~","di sera~","della sera~","pomeridiane~","pm~"],val:12*Bravey.Date.HOUR}],0);t.addMatch(new RegExp("\\b(per le\\b|l\\b|alle\\b|la\\b|le\\b)?"+Bravey.Text.WORDSEP+"(ore\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"(e\\b|:\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)?"+Bravey.Text.WORDSEP+r.regex()+Bravey.Text.WORDSEP+"( minuti)?"+Bravey.Text.WORDSEP+n.regex()+"\\b","gi"),function(e){var t=1*e[3]*Bravey.Date.HOUR;if(e[4]&&e[5]&&(t+=1*e[5]*Bravey.Date.MINUTE),t+=r.get(e,6),t+=n.get(e,8),Bravey.Text.calculateScore(e,[1,2,5,6,7,8]))return Bravey.Date.formatTime(t)}),t.bindTo(this)},Bravey.Language.IT.TimePeriodEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r=new Bravey.Text.RegexMap([{str:["secondo~","secondi~"],val:Bravey.Date.SECOND},{str:["minuti~","minuto~"],val:Bravey.Date.MINUTE},{str:["ore~","ora~"],val:Bravey.Date.HOUR}],0);t.addMatch(new RegExp("\\b(entro\\b|tra\\b|in\\b)"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+r.regex(1),"gi"),function(e){var t,n,i=new Date;if(t=n=i.getHours()*Bravey.Date.HOUR+i.getMinutes()*Bravey.Date.MINUTE,n+=e[2]*r.get(e,3),Bravey.Text.calculateScore(e,[1,3]))return{start:Bravey.Date.formatTime(t),end:Bravey.Date.formatTime(n)}}),t.addMatch(new RegExp("\\b(di sera|della sera|in serata|nella serata|la sera|sera|stasera)\\b","gi"),function(e){return{start:"12:00:00",end:"23:59:00"}}),t.addMatch(new RegExp("\\b(di pomeriggio|del pomeriggio|nel pomeriggio|il pomeriggio|pomeriggio)\\b","gi"),function(e){return{start:"15:00:00",end:"23:59:00"}}),t.addMatch(new RegExp("\\b(di mattina|del mattino|in mattinata|della mattinata|la mattinata|mattina|stamattina)\\b","gi"),function(e){return{start:"08:00:00",end:"12:00:00"}}),t.bindTo(this)},Bravey.Language.IT.DateEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r="\\b(per il\\b|di\\b|nel giorno di\\b|nella giornata di\\b|la giornata di\\b|il\\b|nel\\b|lo scorso\\b)?"+Bravey.Text.WORDSEP,n=new Bravey.Text.RegexMap([{str:["gennaio~","gen~","1~","01~"],val:0},{str:["febbraio~","feb~","2~","02~"],val:1},{str:["marzo~","mar~","3~","03~"],val:2},{str:["aprile~","apr~","4~","04~"],val:3},{str:["maggio~","mag~","5~","05~"],val:4},{str:["giugno~","giu~","6~","06~"],val:5},{str:["luglio~","lug~","7~","07~"],val:6},{str:["agosto~","ago~","8~","08~"],val:7},{str:["settembre~","set~","sept~","9~","09~"],val:8},{str:["ottobre~","ott~","10~"],val:9},{str:["novembre~","nov~","11~"],val:10},{str:["dicembre~","dic~","12~"],val:11}],0);t.addMatch(new RegExp(r+"([0-9]{1,2})"+Bravey.Text.WORDSEP+"(di\\b|,\\b|/\\b|-\\b|\\b)"+Bravey.Text.WORDSEP+n.regex()+Bravey.Text.WORDSEP+"(del\\b|dell'\\b|nel\\b|,\\b|/\\b|-\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var t=new Date,r=t.getFullYear(),i=t.getMonth(),a=t.getDate();if(a=1*e[2],i=n.get(e,4,i),e[6]&&(r=1*e[6]),r=Bravey.Date.centuryFinder(r),Bravey.Text.calculateScore(e,[1,4,6]))return Bravey.Date.formatDate(new Date(r,i,a,0,0,0,0).getTime())},10),t.addMatch(new RegExp(r+n.regex(1)+Bravey.Text.WORDSEP+"([0-9]{1,2})?"+Bravey.Text.WORDSEP+"(del\\b|dell'\\b|,\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var t=new Date,r=t.getFullYear(),i=t.getMonth(),a=1;if(i=n.get(e,2,i),e[3]&&(a=1*e[3]),e[5]&&(r=1*e[5]),r=Bravey.Date.centuryFinder(r),Bravey.Text.calculateScore(e,[1,3,4]))return Bravey.Date.formatDate(new Date(r,i,a,0,0,0,0).getTime())},5),r="\\b(per\\b|di\\b|nel giorno di\\b|nella giornata di\\b|la giornata di\\b|lo scorso\\b)?"+Bravey.Text.WORDSEP,t.addMatch(new RegExp(r+"(oggi)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime())}),t.addMatch(new RegExp(r+"(domani)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(dopodomani)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+2*Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(ieri)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(l'altro ieri|ieri l'altro)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-2*Bravey.Date.DAY)}),t.bindTo(this)},Bravey.Language.IT.FreeTextEntityRecognizer=function(e,t){var r=["grazie","per favore"],n=new Bravey.FreeTextEntityRecognizer(e,t);n.addConjunction("il"),n.addConjunction("lo"),n.addConjunction("la"),n.addConjunction("i"),n.addConjunction("gli"),n.addConjunction("le"),n.addConjunction("è"),n.addConjunction("é"),n.addConjunction("e"),n.addConjunction("ed"),n.addConjunction("e'"),n.addConjunction("sia"),n.addConjunction("mi pare"),n.addConjunction("dovrebbe essere"),n.addConjunction("sarebbe");for(var i=0;i<r.length;i++)n.addConjunction(r[i]),n.addConjunction(","+r[i]),n.addConjunction(", "+r[i]);return n},Bravey.Language.IT.Numbers=[{prefix:"zero",value:0},{prefix:"vent",value:20},{prefix:"trent",value:30},{prefix:"quarant",value:40},{prefix:"cinquant",value:50},{prefix:"sessant",value:60},{prefix:"settant",value:70},{prefix:"ottant",value:80},{prefix:"novant",value:90},{prefix:"uno",value:1},{prefix:"quattro",value:4},{prefix:"quattor",value:4},{prefix:"cinque",value:5},{prefix:"quin",value:5},{prefix:"sei",value:6},{prefix:"sette",value:7},{prefix:"otto",value:8},{prefix:"nove",value:9},{prefix:"dieci",value:10},{prefix:"dici",value:10},{prefix:"se",value:6},{prefix:"un",value:1},{prefix:"due",value:2},{prefix:"do",value:2},{prefix:"tre",value:3},{prefix:"a",skip:1},{prefix:"tor",skip:1},{prefix:"i",skip:1},{prefix:"n",skip:1},{prefix:"s",skip:1},{prefix:"cento",mul:100},{prefix:"mila",mul:1e3,end:1},{prefix:"mille",mul:1e3,end:1},{prefix:"milion",mul:1e6,end:1},{prefix:"miliard",mul:1e9,end:1},{prefix:"e",skip:1},{prefix:"i",skip:1},{prefix:"o",skip:1}],Bravey.Language.IT.NumberEntityRecognizer=function(e,t){var r=new RegExp("^[0-9]+$","gi"),n=new Bravey.RegexEntityRecognizer(e);return n.addMatch(new RegExp("(\\w+)","gi"),function(e){var t,n,i=e[0].toLowerCase(),a=0,s=0,o=9990,u=!1;if(i.match(r))return 1*i;do{t=!1;for(var l=0;l<Bravey.Language.IT.Numbers.length&&(n=Bravey.Language.IT.Numbers[l],i.substr(0,n.prefix.length)!=n.prefix||(i=i.substr(n.prefix.length),n.skip?t=!0:(o?n.end?(l<o&&(a+=s,s=0),o=l):(a+=s,s=0,o=0):n.end&&(o=l),void 0!==n.value&&(s+=n.value,t=!0,u=!0),void 0!==n.mul&&(s?s*=n.mul:s=n.mul,t=!0,u=!0)),!t));l++);}while(t);return a+=s,!i&&u?a:void 0}),n},Bravey.Nlp.Fuzzy=function(e,t){function r(e){e.sort(function(e,t){return e.position<t.position?-1:e.position>t.position?1:e.string.length>t.string.length?-1:e.string.length<t.string.length?1:e.priority>t.priority?-1:e.priority<t.priority?1:0})}function n(e,t){for(var n=[],i={},a=0;a<t.length;a++)i[t[a].entity]||(i[t[a].entity]=1,c[t[a].entity].getEntities(e,n));return r(n),n}function i(e,t){for(var r,i,a,s=n(e,t.entities),o=[],u={},l=[],c=-1,f="",v=!1,g=!1,d=!1,h={},b=0,p=0;p<s.length;p++)if(r=s[p].entity,s[p].position>=c)if(t.index[r])if(void 0==h[r]&&(h[r]=0),i=t.index[r][h[r]]){h[r]++,b++;var m={position:s[p].position,entity:r,value:s[p].value,string:s[p].string,id:i};o.push(m),u[m.id]=m,a=-1==c?e.substr(0,s[p].position):e.substr(c,s[p].position-c),a.length&&l.push({string:a}),l.push(m),f+=a,f+="{"+r+"}",c=s[p].position+s[p].string.length}else v=!0;else g=!0;return a=e.substr(-1==c?0:c),a.length&&(a.length&&l.push({string:a}),f+=a),{found:b,missingEntities:d,exceedEntities:v,extraEntities:g,text:f,entities:o,sentence:l,entitiesIndex:u}}function a(e,t,r){for(var i,a,s="",o=-1,u=-1,l=n(e,f),c={},v=0;v<l.length;v++)i=l[v].entity,l[v].position>u&&(o++,t.index[i]||(t.index[i]=[]),void 0==c[i]?c[i]=0:c[i]++,a=t.index[i][c[i]],a||(a=t.index[i][c[i]]=r&&r[o]?r[o]:i+(c[i]?c[i]:""),t.entities.push({entity:i,id:a})),s+=-1==u?e.substr(0,l[v].position):e.substr(u,l[v].position-u),s+="{"+i+"}",u=l[v].position+l[v].string.length);return s+=e.substr(-1==u?0:u),{text:s}}function s(e,t,r){var n,i=-1,a={};return e.replace(/\{([.a-z_-]+)\}/g,function(e,s){i++,t.index[s]||(t.index[s]=[]),void 0==a[s]?a[s]=0:a[s]++,(n=t.index[s][a[s]])||(n=t.index[s][a[s]]=r&&r[i]?r[i]:s+(a[s]?a[s]:""),t.entities.push({entity:s,id:n}))}),{text:e}}function o(e){for(var t,r,i,a=[],s={},o=[],u="",l={},c=-1,v=-1,g=0,d=n(e,f),h=0;h<d.length;h++)if(r=d[h].entity,d[h].position>c){g++,v++,void 0==l[r]?l[r]=0:l[r]++,i=r+(l[r]?l[r]:"");var b={position:d[h].position,entity:r,value:d[h].value,string:d[h].string,id:i};a.push(b),s[b.id]=b,t=-1==c?e.substr(0,d[h].position):e.substr(c,d[h].position-c),t.length&&o.push({string:t}),o.push(b),u+=t,u+="{"+r+"}",c=d[h].position+d[h].string.length}return t=e.substr(-1==c?0:c),t.length&&(t.length&&o.push({string:t}),u+=t),{found:g,text:u,entities:a,sentence:o,entitiesIndex:s}}t=t||{};var u={},l=new Bravey.DocumentClassifier(t),c={},f=[],v=.75;this.addIntent=function(e,t){for(var r={},n=0;n<t.length;n++)r[t[n].entity]||(r[t[n].entity]=[]),r[t[n].entity].push(t[n].id);return u[e]={name:e,entities:t,index:r},!0},this.addEntity=function(e){var t=e.getName();return c[t]||f.push({entity:t,id:"none"}),c[t]=e,!0},this.hasEntity=function(e){return!!c[e]},this.setConfidence=function(e){v=e},this.getConfidence=function(e){return v},this.addDocument=function(e,t,r){if(r){if(r.fromFullSentence){if(e=Bravey.Text.clean(e),r.expandIntent){u[t]||this.addIntent(t,[]);var n=a(e,u[t],r.withNames);return l.addDocument(n.text,t)}}else if(r.fromTaggedSentence&&r.expandIntent){u[t]||this.addIntent(t,[]);var n=s(e,u[t],r.withNames);return l.addDocument(n.text,t)}return!1}return!!u[t]&&l.addDocument(Bravey.Text.clean(e),t)},this.test=function(e,t){switch(e=Bravey.Text.clean(e),t){case"anyEntity":var r=o(e),n=l.classifyDocument(r.text);return r.score=n.winner.score,r.intent=n.winner.label,r;default:var n,a,r=!1,s=-1,c=-1;for(var f in u)a=i(e,u[f]),a.exceedEntities||a.extraEntities||a.missingEntities||(n=l.classifyDocument(a.text),n.scores[f]>v&&(n.scores[f]>s||n.scores[f]==s&&a.found>c)&&(r=a,r.score=s=n.scores[f],c=r.found,r.intent=f));return r}return!1}},Bravey.Nlp.Sequential=function(e,t){function r(e){return e.split(/~/)[0]}function n(e){e.sort(function(e,t){return e.position<t.position?-1:e.position>t.position?1:e.string.length>t.string.length?-1:e.string.length<t.string.length?1:e.priority>t.priority?-1:e.priority<t.priority?1:0})}function i(e,t){for(var r=[],i={},a=0;a<t.length;a++)i[t[a].entity]||(i[t[a].entity]=1,c[t[a].entity].getEntities(e,r));return n(r),r}function a(e,t,r){for(var n,a,s=t||"",o="",u=[],l={},c=0,v=-1,g=i(e,f),d=0;d<g.length;d++)a=g[d].entity,g[d].position>=v&&(s+="~"+a,void 0==l[a]?l[a]=0:l[a]++,n=r&&r[c]?r[c]:a+(l[a]?l[a]:""),u.push({entity:a,id:n}),o+=-1==v?e.substr(0,g[d].position):e.substr(v,g[d].position-v),o+="{"+a+"}",v=g[d].position+g[d].string.length,c++);return o+=e.substr(-1==v?0:v),{error:!1,text:o,name:s,entities:u}}function s(e,t,r){var n,i=-1,a={},s=t||"",o=[],a={},i=0,u=!1;return e.replace(/\{([.a-z_-]+)\}/g,function(e,t){c[t]?(s+="~"+t,void 0==a[t]?a[t]=0:a[t]++,n=r&&r[i]?r[i]:t+(a[t]?a[t]:""),o.push({entity:t,id:n}),i++):u=t}),{error:u,text:e,name:s,entities:o}}function o(e,t){function r(){for(;t.entities[l]&&c[t.entities[l].entity].expand;){var r={position:u<0?0:u,entity:t.entities[l].entity,value:"",string:e.substr(u<0?0:u),id:t.entities[l].id};o[r.id]=r,s.push(r),l++}}var n,a=i(e,t.entities),s=[],o={},u=-1,l=0;if(r(),a.length){for(var f=0;f<a.length;f++)if(n=a[f].entity,a[f].position>=u&&t.entities[l].entity==n){var v={position:a[f].position,entity:n,value:a[f].value,string:a[f].string,id:t.entities[l].id};if(s.push(v),o[v.id]=v,u=a[f].position+a[f].string.length,l++,r(),l>=t.entities.length)break}}else t.entities.length;for(var g,d,h="",b="",u=0,p=[],f=0;f<s.length;f++)c[s[f].entity].expand&&(g=s[f+1],g&&(s[f].string=s[f].string.substr(0,g.position-s[f].position)),d=s[f].position,c[s[f].entity].expand(s[f]),c[s[f].entity].position>d&&(b=e.substr(u,c[s[f].entity].position-d),p.push({string:b}),h+=b,u+=c[s[f].entity].position-d)),b=e.substr(u,s[f].position-u),b&&(p.push({string:b}),h+=b),p.push(s[f]),h+="{"+s[f].entity+"}",u=s[f].position+s[f].string.length;return(b=e.substr(u))&&(p.push({string:b}),h+=b),{found:s.length,exceedEntities:!1,missingEntities:s.length<t.entities.length,extraEntities:s.length>t.entities.length,text:h,entities:s,sentence:p,entitiesIndex:o}}t=t||{};var u={},l=new Bravey.DocumentClassifier(t),c={},f=[],v=.75;this.addIntent=function(e,t){for(var r={},n=e,i=0;i<t.length;i++)n+="~"+t[i].entity,r[t[i].entity]||(r[t[i].entity]=[]),r[t[i].entity].push(t[i].id);return u[n]={name:n,root:e,entities:t,index:r},!0},this.addEntity=function(e){var t=e.getName();return c[t]||f.push({entity:t,id:"none"}),c[t]=e,!0},this.hasEntity=function(e){return!!c[e]},this.setConfidence=function(e){v=e},this.getConfidence=function(e){return v},this.addDocument=function(e,t,n){if(n){if(n.fromFullSentence){if(e=Bravey.Text.clean(e),n.expandIntent){var i=a(e,t,n.withNames);return u[i.name]||this.addIntent(t,i.entities),l.addDocument(i.text,t)}}else if(n.fromTaggedSentence){var i=s(e,t,n.withNames);return!1===i.error&&(u[i.name]||this.addIntent(t,i.entities),l.addDocument(i.text,t))}return!1}return!!u[t]&&l.addDocument(Bravey.Text.clean(e),r(t))},this.test=function(e,t){e=Bravey.Text.clean(e);var r,n,i,a=!1,s=-1,c=-1;for(var f in u)i=o(e,u[f]),i.exceedEntities||i.extraEntities||i.missingEntities||(n=l.classifyDocument(i.text),(r=n.scores[u[f].root])>v&&(r>s||i.found>c)&&(a=i,a.score=s=r,c=a.found,a.intent=u[f].root));return a}},Bravey.ContextManager=function(e){e=e||{};var t=["default"],r={},n={},i=e.sessionManager||new Bravey.SessionManager.InMemorySessionManager(e);this.addNlp=function(e,i,a){i||(i=t);for(var s=0;s<i.length;s++)r[i[s]]||(r[i[s]]=[],n[i[s]]=[]),-1==r[i[s]].indexOf(e)&&(r[i[s]].push(e),n[i[s]].push({method:a}))},this.removeNlp=function(e,t){var i;if(t)for(var a=0;a<t.length;a++)-1!=(i=r[t[a]].indexOf(e))&&(r[t[a]].splice(i,1),n[t[a]].splice(i,1));else for(var a in r)-1!=(i=r[a].indexOf(e))&&(r[a].splice(i,1),n[a].splice(i,1))},this.removeContext=function(e){r[e]&&delete r[e]},this.setSessionIdContext=function(e,t){return i.setContext(e,t)},this.setSessionIdData=function(e,t){return i.setData(e,t)},this.clearSessionIdData=function(e){return i.clearData(e)},this.getSessionIdData=function(e){return i.getData(e)},this.reserveSessionId=function(e){return i.reserveSessionId(e)},this.testByContext=function(e,i){var a,s={result:!1};i||(i=t);for(var o=0;o<i.length;o++)if(r[i[o]])for(var u=0;u<r[i[o]].length;u++)a=r[i[o]][u].test(e,n[i[o]][u].method),(!s.result||a.score&&a.score>s.result.score||a.score==s.result.score||a.found>s.result.found)&&(s.result=a,s.context=i[o]);return s},this.testBySessionId=function(e,t){var r={result:!1};if(void 0===t?t=i.reserveSessionId():i.keepAlive(t)){var n=i.getContext(t);r=this.testByContext(e,n),r.sessionId=t,r.sessionContext=n,r.sessionData=i.getData(t)}return r}},Bravey.SessionManager.InMemorySessionManager=function(e){function t(){return(new Date).getTime()}function r(){var e=t();for(var r in i)e-i[r].timestamp>a&&delete i[r]}function n(){return{context:["default"],data:{},timestamp:t()}}e||(e={});var i={},a=e.sessionLength||6e5;this.reserveSessionId=function(e){if(void 0==e)do{e=Bravey.Text.generateGUID()}while(i[e]);return r(),i[e]||(i[e]=n()),e},this.keepAlive=function(e){return!!i[e]&&(i[e].timestamp=t(),!0)},this.setContext=function(e,t){return!!i[e]&&(i[e].context=t,this.keepAlive(e),!0)},this.setData=function(e,t){if(i[e]){for(var r in t)i[e].data[r]=t[r];return this.keepAlive(e),!0}return!1},this.clearData=function(e,t){return!!i[e]&&(i[e].data={},this.keepAlive(e),!0)},this.getContext=function(e){if(i[e])return i[e].context},this.getData=function(e){if(i[e])return i[e].data}},Bravey.Filter.BasicFilter=function(e){for(var t=[],r=0;r<e.length;r++)"{"!=e[r][0]&&e[r].length>3&&t.push(e[r]);return t.length<3?e:t};